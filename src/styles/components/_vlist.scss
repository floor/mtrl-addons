// src/styles/components/_vlist.scss
@use "../../../../mtrl/src/styles/abstract/base" as base;
@use "../../../../mtrl/src/styles/abstract/variables" as v;
@use "../../../../mtrl/src/styles/abstract/functions" as f;
@use "../../../../mtrl/src/styles/abstract/mixins" as m;
@use "../../../../mtrl/src/styles/abstract/theme" as t;

// ===========================
// Variables & Configuration
// ===========================

// Component prefixes
$prefix: base.$prefix;
$component: "#{$prefix}-vlist";
$viewport: "#{$prefix}-viewport";
$viewport-item: "#{$prefix}-viewport-item";

// Transitions
$transition-duration: v.motion("duration-medium1");
$transition-easing: v.motion("easing-standard");

// Common transitions
$bg-transition: background-color $transition-duration $transition-easing;
$opacity-transition: opacity $transition-duration $transition-easing;

// ===========================
// Animations
// ===========================

@keyframes placeholder-pulse {
  0%,
  100% {
    opacity: 0.6;
  }
  50% {
    opacity: 0.4;
  }
}

@keyframes fade-in {
  from {
    opacity: 0.6;
  }
  to {
    opacity: 1;
  }
}

// ===========================
// Main VList Container
// ===========================

.#{$component} {
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 100px;
  background-color: t.color("surface");
  border: 2px solid var(--mtrl-sys-color-outline-variant);
  border-radius: 3px;
  transition: $bg-transition;

  // Performance optimizations
  contain: layout style paint;
  transform: translateZ(0);
  backface-visibility: hidden;

  // Selection mode
  &--selection {
    cursor: pointer;
    .#{$viewport-item}:hover {
      background-color: t.alpha(t.color("on-surface-variant"), 0.04);
    }
  }

  // Disabled state
  &--disabled {
    pointer-events: none;
    opacity: 0.38;
    transition: $opacity-transition;
  }
}

// ===========================
// Viewport Structure
// ===========================

.#{$viewport} {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;

  // Items container
  &-items {
    position: relative;
    width: 100%;
    height: 100%;
    padding: 8px 0;
    will-change: transform;
  }
}

.#{$viewport-item} {
  opacity: 1;
  transition: $opacity-transition;
  will-change: transform;
  // Apply fade-in animation to items that replace placeholders
  &--replaced {
    animation: fade-in 0.3s ease-out;
  }
}

.#{$viewport-item} {
  padding: 12px 16px 20px;
  display: flex;
  align-items: start;
  transition: background-color 0.2s ease;
  align-items: center;
  min-height: 48px;
  left: 0;
  right: 0;
  width: 100%;
  will-change: transform;
  contain: layout style;
  gap: 16px;
  color: var(--mtrl-sys-color-on-surface);
  overflow: hidden;
}

.#{$viewport-item}__avatar,
.#{$viewport-item}__image {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: var(--mtrl-sys-color-primary-container);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  flex-shrink: 0;
}

.#{$viewport-item}__details {
  flex: 1;
  min-width: 0;
  margin-left: 12px;
}

.#{$viewport-item}__headline {
  font-weight: 500;
}

.#{$viewport-item}__text {
  // color: #666;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.#{$viewport-item}__meta {
  color: var(--mtrl-sys-color-on-surface-variant);
  font-size: 12px;
  margin-top: 2px;
}

// ===========================
// Placeholder Styling
// ===========================

.#{$viewport-item}--placeholder {
  opacity: 0.6; // Match the animation start/end opacity
  animation: placeholder-pulse 2s ease-in-out infinite;

  // Placeholder content blocks - style any text elements within
  .#{$viewport-item}__headline,
  .#{$viewport-item}__text,
  .#{$viewport-item}__meta {
    position: relative;
    display: inline-block;
    font-size: 0.8em;
    color: transparent;
    background-color: var(--mtrl-sys-color-on-surface);
    border-radius: 0.1em;
    opacity: 0.4;
    text-decoration: none;
    line-height: 1;
    padding: 0 0 0.05em;
    vertical-align: middle;
  }

  // Layout adjustments
  .#{$viewport-item}__text,
  .#{$viewport-item}__meta {
    margin-top: 0.2em;
  }

  // User-specific placeholder elements
  .#{$viewport-item}__user-headline,
  .#{$viewport-item}__user-text {
    text-transform: capitalize;
  }

  // Avatar placeholder
  .#{$viewport-item}__avatar {
    background-color: var(--mtrl-sys-color-primary-container);
    color: var(--mtrl-sys-color-primary-container);
    opacity: 1;
  }
}

// ===========================
// Custom Scrollbar
// ===========================

.#{$viewport}__scrollbar {
  position: absolute;
  top: 0;
  right: 0;
  width: 8px;
  height: 100%;
  background: rgba(0, 0, 0, 0.05);
  opacity: 0;
  transition: opacity 0.3s ease;
  cursor: pointer;
  z-index: 10;

  // Visibility states
  &--visible,
  &--dragging,
  &:hover {
    opacity: 1;
  }

  // Scrollbar thumb
  &-thumb {
    position: absolute;
    top: 0;
    width: 100%;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    min-height: 15px;
    will-change: transform;
    cursor: grab;
    transition: background 0.2s ease;

    &:hover {
      background: rgba(0, 0, 0, 0.5);
    }

    &:active,
    &--dragging {
      cursor: grabbing;
      background: rgba(0, 0, 0, 0.6);
    }
  }
}

// ===========================
// Dark Theme Support
// ===========================

@media (prefers-color-scheme: dark) {
  .#{$viewport}__scrollbar {
    background: rgba(255, 255, 255, 0.1);

    &-thumb {
      background: rgba(255, 255, 255, 0.3);

      &:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      &:active,
      &--dragging {
        background: rgba(255, 255, 255, 0.6);
      }
    }
  }
}

// ===========================
// Performance Optimizations
// ===========================

// High-density displays
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .#{$viewport-item} {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}
